# SwiftUIで破綻しないための
# コンポーネント設計と構造パターン実践

佐藤 晶彦 / @akkiee76

## 1. はじめに

SwiftUIはWWDC 2019で発表されて以来、毎年目覚ましい進化を遂げています。SwiftUIでの開発は宣言的で簡潔な記述ができる一方、画面が大規模・複雑になるにつれて、多くの開発者は思わぬ設計課題に直面することも少なくありません。

本記事では、多くの開発者が直面しやすい課題にフォーカスし、Appleが紹介するSwiftUIのプラクティスをベースに、具体的なコード例を交えてアプローチを紹介します。

本記事がSwiftUIで複雑な画面を設計している方、構造的なView設計に悩んでいる方の参考になれば幸いです。


## 2. SwiftUIが直面する設計課題

SwiftUIの宣言的な記法は一見シンプルで強力ですが、実際の開発現場ではプロジェクトの規模が大きくなるにつれ、構造の複雑化や保守性の低下といった課題が顕在化しやすくなります。

とくに、大規模な画面や状態を多く含む複雑なUIを実装する場合、Viewのネストが深くなり、状態や分岐が絡み合うことでコードの見通しが悪くなります。また、設計当初は「再利用性を高めるための共通化」を目指していたコンポーネントも、実装が進むにつれてProps（プロパティ）が増え、かえって使いにくくなるケースも少なくありません。

さらに、状態管理の設計が不十分なまま拡張を続けると、Viewが本来の「表示の責務」を超えて状態の持ちすぎやロジックの肥大化に陥ることがあります。結果として、後から仕様変更やデザイン変更があった際の影響範囲が広がり、保守コストが増大してしまいます。

本記事では、こうしたSwiftUI特有の設計課題を、以下の5つのテーマにフォーカスして取り上げます。

- View構造の複雑化に伴う可読性の低下
- コードからデザインの想像が困難
- 再利用性・コンポーネント化のハードル
- 状態管理におけるViewの責務超過
- Preview機能の破綻

これらの課題に対して、Appleが推奨するをはじめとした設計アプローチをベースに、具体的なコード例とともに解決策を探っていきます。

### 2.1 View構造の複雑化に伴う可読性の低下

SwiftUIを使った開発が進むにつれ、1つの画面にifやswitchを使った複数の状態や分岐が増え、bodyが肥大化してView全体の構造を把握しづらくなることがあります。

こうした肥大化を避けるためには、Identity（識別性）やDependencies（依存関係）といった観点を意識することが重要です。

#### Identity（識別性）

SwiftUIでは、Viewは「値」として宣言され、再生成・再評価を繰り返しますが、状態を保持するためには「同じViewである」と識別できる必要があります。ifやswitchを多用すると、Viewの条件分岐が深くなり、内部的にSwiftUIがViewの同一性を判別するロジックが複雑化します。

以下は、条件によって異なるViewを定義しているコード例です。

<figure>

<figcaption>異なるIdentityを持つViewを条件分岐で切り替える例</figcaption>

```Swift
VStack {
  if dog.isGood {
    PawView(tint: .green)
    Spacer()
  } else {
    Spacer()
    PawView(tint: .red)
  }
}
```

</figure>

このコードでは、画面上では同じように見えるViewが表示されますが、内部的には異なるIdentityを持つ別のViewとして扱われるため、条件が変わるたびにViewの差し替えが発生します。さらにViewが複雑になると、可読性の低下やパフォーマンスへの影響も考えられます。

次に、同一のIdentityを持ちながらカラーやレイアウトのみを切り替えるように改善した例を示します。

<figure>

<figcaption>異なるViewを定義した条件分岐</figcaption>

```Swift
PawView(tint: dog.isGood ? .green : .red)
.frame(
  maxHeight: .infinity,
  alignment: dog.isGood ? .top : .bottom
)
```

</figure>

同一のIdentityを持つViewに変更することで、可読性が向上し、状態変化時のスムーズなレイアウト移行が期待できます。

このように、SwiftUIではViewの同一性を維持した設計が推奨されています。


#### Dependencies（依存関係）

Viewは依存する状態やBindingが変わるたびに再評価されます。

大きなbodyに複数の状態を直接含めると、依存関係の範囲が広がり、可読性と保守性が低下。

小さなViewに切り出し、それぞれが必要な最小限の依存状態のみを持つ構造にすることで、再評価の範囲を局所化できます。


### 2.2 コードからデザインの想像が困難
Composition関連の話

### 2.3 再利用性とコンポーネント設計
Composition関連の話、どのプラットフォームでも利用可能

### 2.4 状態管理と責務分離

ViewModelとViewの責務分離、TCAの導入など

### 2.5 Previewを維持する

## 3. さいごに


